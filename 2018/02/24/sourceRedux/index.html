<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="jaaaelu eslint yarn">
    

    <!--Author-->
    
        <meta name="author" content="jaaaelu">
    

    <!-- Title -->
    
    <title>Reduxæºç é˜…è¯»ç¬”è®° | Jaaaelu - Girlthub</title>

    <!-- Bootstrap Core CSS -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <!-- Content -->
    <section class="article-container">
<!-- Back Home -->
<a class="nav-back" href="/">
    <i class="fa fa-puzzle-piece"></i>
</a>

<!-- Page Header -->
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Reduxæºç é˜…è¯»ç¬”è®°</h1>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Main Content -->
            <div class="post-content col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>ä¹‹å‰å¾®åšçƒ­é—¨çœ‹äº†ä¸€ä¸ªï¼ˆæ¼‚äº®ï¼‰ç¨‹åºåª›çš„ä¸€å¤©<br>çœ‹åˆ°æœ‰äººæ‰¹è¯„å¦¹å­è¯´ï¼š<br>â€œä¸€çœ‹è¿™ä¸€å¤©å°±æ²¡å†™å¤šå°‘ä»£ç ã€‚â€<br>éº»çƒ¦çœ‹ä¸‹Reduxæºç ï¼Œ<br>å¥½ä»£ç ä»ä¸ä»¥é‡å–èƒœã€‚</p>
<a id="more"></a>
<hr>
<p>çœ‹Reduxæºç è¿˜æ˜¯æŒºè½»æ¾çš„ï¼š<br>ä»£ç ä¸è¿‡å‡ åƒè¡Œï¼›<br>è¯¥æŠ½çš„ç»„ä»¶æŠ½çš„ååˆ†æ¸…æ™°ï¼›<br>å…³é”®æ˜¯ï¼Œ<br>å‡½æ•°å‘½åå’Œå˜é‡åéƒ½éå¸¸å¥½æ‡‚ï¼Œ<br>å¥½æ‡‚åˆ°ä½ çœ‹åå­—èƒ½çŒœå‡ºå®ƒæ˜¯å¹²å˜›ä½¿çš„â€¦â€¦</p>
<p>ï¼ˆä½†æ˜¯è¿™ä¸ªæ¡†æ¶è¿˜æ˜¯æœ‰äº›ç¹é‡å•Š55555ï¼Œå°¤å…¶æœ€è¿‘åŠ ä¸Šäº†Typesciptâ€¦..ï¼‰</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼ŒReduxçš„æºä»£ç ç”±ä»¥ä¸‹JSæ–‡ä»¶ç»„æˆï¼š</p>
<ul>
<li>createStore</li>
<li>combineReducers</li>
<li>bindActionCreators</li>
<li>applyMiddleware</li>
<li>compose</li>
<li>warning</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬æ¥ä¸€ä¸€è®²è§£æºä»£ç ï¼š</p>
<h2 id="combineReducers-reducer"><a href="#combineReducers-reducer" class="headerlink" title="combineReducers(reducer)"></a>combineReducers(reducer)</h2><p>æŠŠä¸€ä¸ªç”±å¤šä¸ªä¸åŒ reducer å‡½æ•°ä½œä¸º value çš„ objectï¼Œåˆå¹¶æˆä¸€ä¸ªæœ€ç»ˆçš„ reducer å‡½æ•°ï¼Œç„¶åå°±å¯ä»¥å¯¹è¿™ä¸ª reducer è°ƒç”¨ createStoreã€‚</p>
<pre><code>import { ActionTypes } from &apos;./createStore&apos;
import isPlainObject from &apos;lodash/isPlainObject&apos;
import warning from &apos;./utils/warning&apos;

// reducerå‚æ•°è§„å®šä¼ å…¥çš„stateä¸èƒ½ä¸ºundefinedï¼ŒåŸå› å°±æ˜¯ä¸‹é¢çš„è¿™ä¸ªå‡½æ•°ï¼

function getUndefinedStateErrorMessage(key, action) {
  const actionType = action &amp;&amp; action.type
  const actionName = (actionType &amp;&amp; `&quot;${actionType.toString()}&quot;`) || &apos;an action&apos;

  return (
    `Given action ${actionName}, reducer &quot;${key}&quot; returned undefined. ` +
    `To ignore an action, you must explicitly return the previous state. ` +
    `If you want this reducer to hold no value, you can return null instead of undefined.`
  )
}

function getUnexpectedStateShapeWarningMessage(inputState, reducers, action, unexpectedKeyCache) {
  const reducerKeys = Object.keys(reducers)
  const argumentName = action &amp;&amp; action.type === ActionTypes.INIT ?
    &apos;preloadedState argument passed to createStore&apos; :
    &apos;previous state received by the reducer&apos;

// æ£€æµ‹reduceræ˜¯å¦ä¸ºç©º
  if (reducerKeys.length === 0) {
    return (
      &apos;Store does not have a valid reducer. Make sure the argument passed &apos; +
      &apos;to combineReducers is an object whose values are reducers.&apos;
    )
  }

// æ£€æµ‹åˆå§‹stateæ˜¯å¦ä¸ºç©º
  if (!isPlainObject(inputState)) {
    return (
      `The ${argumentName} has unexpected type of &quot;` +
      ({}).toString.call(inputState).match(/\s([a-z|A-Z]+)/)[1] +
      `&quot;. Expected argument to be an object with the following ` +
      `keys: &quot;${reducerKeys.join(&apos;&quot;, &quot;&apos;)}&quot;`
    )
  }

  const unexpectedKeys = Object.keys(inputState).filter(key =&gt;
    !reducers.hasOwnProperty(key) &amp;&amp;
    !unexpectedKeyCache[key]
  )

  unexpectedKeys.forEach(key =&gt; {
    unexpectedKeyCache[key] = true
  })

  if (unexpectedKeys.length &gt; 0) {
    return (
      `Unexpected ${unexpectedKeys.length &gt; 1 ? &apos;keys&apos; : &apos;key&apos;} ` +
      `&quot;${unexpectedKeys.join(&apos;&quot;, &quot;&apos;)}&quot; found in ${argumentName}. ` +
      `Expected to find one of the known reducer keys instead: ` +
      `&quot;${reducerKeys.join(&apos;&quot;, &quot;&apos;)}&quot;. Unexpected keys will be ignored.`
    )
  }
}

// ç”±ä¸‹é¢çš„å¼•ç”¨å¾—çŸ¥ï¼Œæ­¤å¤„ä¼ å…¥çš„reducerä¸ºfinalReducer || {}
function assertReducerShape(reducers) {
  Object.keys(reducers).forEach(key =&gt; {
const reducer = reducers[key]
// åˆå§‹stateä¸ºundefined,åˆå§‹typeä¸ºActionTypes.INIT
    const initialState = reducer(undefined, { type: ActionTypes.INIT })

    // æ£€æµ‹initialStateè¿”å›å€¼æ˜¯å¦ä¸ºundefined
    if (typeof initialState === &apos;undefined&apos;) {
      throw new Error(
        `Reducer &quot;${key}&quot; returned undefined during initialization. ` +
        `If the state passed to the reducer is undefined, you must ` +
        `explicitly return the initial state. The initial state may ` +
        `not be undefined. If you don&apos;t want to set a value for this reducer, ` +
        `you can use null instead of undefined.`
      )
    }

    // æ£€æµ‹typeï¼ˆéšæœºï¼‰è¿”å›å€¼æ˜¯å¦ä¸ºundefined
    const type = &apos;@@redux/PROBE_UNKNOWN_ACTION_&apos; + Math.random().toString(36).substring(7).split(&apos;&apos;).join(&apos;.&apos;)
    if (typeof reducer(undefined, { type }) === &apos;undefined&apos;) {
      throw new Error(
        `Reducer &quot;${key}&quot; returned undefined when probed with a random type. ` +
        `Don&apos;t try to handle ${ActionTypes.INIT} or other actions in &quot;redux/*&quot; ` +
        `namespace. They are considered private. Instead, you must return the ` +
        `current state for any unknown actions, unless it is undefined, ` +
        `in which case you must return the initial state, regardless of the ` +
        `action type. The initial state may not be undefined, but can be null.`
      )
    }
  })
}



 // å¯¼å‡ºå‡½æ•°ï¼Œreducersä¸ºåŒ…å«å¤šä¸ªreducerçš„objï¼Œå¦‚{reducer1,reducer2}
export default function combineReducers(reducers) {
    // éå†æ¯ä¸ªreducer
  const reducerKeys = Object.keys(reducers)
  const finalReducers = {}
 // è¿‡æ»¤ä¸åˆæ ¼ç±»å‹çš„reducer
  for (let i = 0; i &lt; reducerKeys.length; i++) {
    const key = reducerKeys[i]

    // åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œreducerçš„å€¼å¦‚æœä¸ºundefinedï¼Œåˆ™æŠ¥é”™
    if (process.env.NODE_ENV !== &apos;production&apos;) {
      if (typeof reducers[key] === &apos;undefined&apos;) {
        warning(`No reducer provided for key &quot;${key}&quot;`)
      }
    }

    // ä¼ å…¥çš„reducerå¿…é¡»æ˜¯ä¸ªfunction
    if (typeof reducers[key] === &apos;function&apos;) {
      finalReducers[key] = reducers[key]
    }
  }
 // å¾—åˆ°åˆæ ¼çš„reducerï¼Œæˆä¸ºfinalReducers
  const finalReducerKeys = Object.keys(finalReducers)

  let unexpectedKeyCache
  if (process.env.NODE_ENV !== &apos;production&apos;) {
    unexpectedKeyCache = {}
  }

  let shapeAssertionError
  try {
    // å†æ£€æµ‹reducerçš„åˆå§‹stateå’Œtypeè¿”å›å€¼æ˜¯å¦åˆæ ¼
    assertReducerShape(finalReducers)
  } catch (e) {
    shapeAssertionError = e
  }

  // è¿”å›çš„å‡½æ•°å€¼å’Œreducerä¸€æ ·ï¼Œæ¥å—stateå’Œacitonä¸¤ä¸ªå‚æ•°
  return function combination(state = {}, action) {
    if (shapeAssertionError) {
      throw shapeAssertionError
    }

    if (process.env.NODE_ENV !== &apos;production&apos;) {
      const warningMessage = getUnexpectedStateShapeWarningMessage(state, finalReducers, action, unexpectedKeyCache)
      if (warningMessage) {
        warning(warningMessage)
      }
    }

    let hasChanged = false
const nextState = {}

    for (let i = 0; i &lt; finalReducerKeys.length; i++) {
      const key = finalReducerKeys[i]
const reducer = finalReducers[key]
// å®šä¹‰æ—§çš„state
const previousStateForKey = state[key]
// æ¥å—æ—§çš„çš„stateå€¼ï¼Œå’Œactionï¼Œå¾—åˆ°æ–°çš„state
      const nextStateForKey = reducer(previousStateForKey, action)
      if (typeof nextStateForKey === &apos;undefined&apos;) {
        const errorMessage = getUndefinedStateErrorMessage(key, action)
        throw new Error(errorMessage)
      }
nextState[key] = nextStateForKey
// å¯¹æ¯”åˆ¤æ–­æ˜¯å¦æ”¹å˜state
      hasChanged = hasChanged || nextStateForKey !== previousStateForKey
}
// æ ¹æ®æ˜¯å¦æ›´æ”¹äº†stateæ¥è¿”å›ä¸åŒçš„stateå€¼
    return hasChanged ? nextState : state
  }
}
</code></pre><h2 id="bindActionCreators-actionCreators-dispatch"><a href="#bindActionCreators-actionCreators-dispatch" class="headerlink" title="bindActionCreators(actionCreators, dispatch)"></a>bindActionCreators(actionCreators, dispatch)</h2><p>æƒŸä¸€ä½¿ç”¨ bindActionCreators çš„åœºæ™¯æ˜¯å½“ä½ éœ€è¦æŠŠ action creator å¾€ä¸‹ä¼ åˆ°ä¸€ä¸ªç»„ä»¶ä¸Šï¼Œå´ä¸æƒ³è®©è¿™ä¸ªç»„ä»¶è§‰å¯Ÿåˆ° Redux çš„å­˜åœ¨ï¼Œè€Œä¸”ä¸å¸Œæœ›æŠŠ Redux store æˆ– dispatch ä¼ ç»™å®ƒã€‚<br>ï¼ˆä¸€èˆ¬ä½¿ç”¨ react-redux æä¾›çš„ connect()æ¥è°ƒç”¨dipatchï¼‰</p>
<pre><code>//è¿”å›çš„å‡½æ•°æ¯”åŸå‡½æ•°å¤šåŒ…äº†ä¸€å±‚dispatch
function bindActionCreator(actionCreator, dispatch) {
  return (...args) =&gt; dispatch(actionCreator(...args))
}


export default function bindActionCreators(actionCreators, dispatch) {
  // æ£€æµ‹å‡½æ•°ç±»å‹ï¼Œåˆ™è¯´æ˜åªæœ‰ä¸€ä¸ªactionCreators
  if (typeof actionCreators === &apos;function&apos;) {
    return bindActionCreator(actionCreators, dispatch)
  }

  // actionCreatorsä¸èƒ½ä¸ºç©ºå€¼æˆ–å¯¹è±¡ä»¥å¤–çš„å€¼
  if (typeof actionCreators !== &apos;object&apos; || actionCreators === null) {
    throw new Error(
      `bindActionCreators expected an object or a function, instead received ${actionCreators === null ? &apos;null&apos; : typeof actionCreators}. ` +
      `Did you write &quot;import ActionCreators from&quot; instead of &quot;import * as ActionCreators from&quot;?`
    )
  }

 //actionCreatorså¦‚æœæ˜¯å¯¹è±¡çš„è¯ï¼Œè¯´æ˜æœ‰å¤šä¸ªactionCreatorï¼Œéå†å¹¶æ£€æµ‹æ˜¯å¦ä¸ºå‡½æ•°ï¼Œæ˜¯åˆ™èµ°bindActionCreator
  const keys = Object.keys(actionCreators)
  const boundActionCreators = {}
  for (let i = 0; i &lt; keys.length; i++) {
    const key = keys[i]
    const actionCreator = actionCreators[key]
    if (typeof actionCreator === &apos;function&apos;) {
      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)
    }
  }
  return boundActionCreators
}
</code></pre><p>ã€æ€»ç»“ã€‘å½“ä½ ä¸æƒ³åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨reduxæ—¶ä½¿ç”¨ã€‚æ­¤å‡½æ•°ç­‰äºæŠŠ action creatorså’Œdispatché€šè¿‡propsä¼ ç»™å­ç»„ä»¶ï¼ï¼ï¼</p>
<pre><code>let boundActionCreators = bindActionCreators(TodoActionCreators, dispatch);
return (
  &lt;TodoList todos={todos}
     {...boundActionCreators} /&gt;
);
</code></pre><p>ç­‰åŒäº</p>
<pre><code>return &lt;TodoList todos={todos} dispatch={dispatch} /&gt;;
</code></pre><h2 id="applyMiddleware-â€¦middlewares"><a href="#applyMiddleware-â€¦middlewares" class="headerlink" title="applyMiddleware(â€¦middlewares)"></a>applyMiddleware(â€¦middlewares)</h2><pre><code>import compose from &apos;./compose&apos;

export default function applyMiddleware(...middlewares) {
  return (createStore) =&gt; (reducer, preloadedState, enhancer) =&gt; {

   ã€ã€ã€ * å…³äºcreateStoreæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š
   //å¦‚æœä¼ å…¥enhancerå‚æ•°ï¼Œå°±è·³å‡ºæ‰§è¡Œenhancerï¼Œä¸å†ç»§ç»­æ‰§è¡ŒcreateStoreä¸‹é¢çš„å‡½æ•°
    if (typeof enhancer !== &apos;undefined&apos;) {
    if (typeof enhancer !== &apos;function&apos;) {
      throw new Error(&apos;Expected the enhancer to be a function.&apos;)
    }

    return enhancer(createStore)(reducer, preloadedState)
  }ã€‘ã€‘ã€‘ã€‘



    //enhancer(createStore)(reducer, preloadedState) å®é™…å°±æ˜¯åœ¨applyMiddlewareä¸­æ‰§è¡ŒcreateStore(reducer,preloadedState)
    const store = createStore(reducer, preloadedState, enhancer)
    let dispatch = store.dispatch
    let chain = []

    //åŒæ ·å®šä¹‰åˆå§‹å€¼ï¼ŒgetStateå’Œdispatch
    const middlewareAPI = {
      getState: store.getState,
      dispatch: (...args) =&gt; dispatch(...args)
    }
    chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))
    //composeï¼šAPIè§£é‡Šè¯¥å‡½æ•°ä½œç”¨æ˜¯ï¼šä»å³åˆ°å·¦æ¥ç»„åˆå¤šä¸ªå‡½æ•°ã€‚å…·ä½“å®ç°çœ‹composeè§£æã€‚
    dispatch = compose(...chain)(store.dispatch)

    return {
      ...store,
      dispatch
    }
  }
}
</code></pre><h2 id="createStore"><a href="#createStore" class="headerlink" title="createStore"></a>createStore</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div></pre></td><td class="code"><pre><div class="line">// æ—¥å¸¸å¼•ç»„ä»¶ï¼Œå…·ä½“ä»€ä¹ˆç”¨ï¼Œçœ‹å®ƒä¸‹é¢ä»€ä¹ˆæ—¶å€™ç”¨åˆ°å†çœ‹</div><div class="line">import isPlainObject from <span class="string">'lodash/isPlainObject'</span></div><div class="line">import $<span class="variable">$observable</span> from <span class="string">'symbol-observable'</span></div><div class="line"></div><div class="line">// ç”¨äºåˆå§‹åŒ–å’Œå®¹é”™</div><div class="line"><span class="built_in">export</span> const ActionTypes = &#123;</div><div class="line">  INIT: <span class="string">'@@redux/INIT'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">/** </div><div class="line">  *	 ä½œè€…çš„ä¸€å¤§ä¸²æ³¨é‡Šï¼Œæ³¨é‡Šå¤ªå¤šï¼Œå†™æˆè¡¨è¾¾å¼å¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ„æ€</div><div class="line">  * <span class="keyword">if</span>(!action.Type)&#123; // æ²¡ä¼ action.Type</div><div class="line">  *  <span class="built_in">return</span> currentState || initialState</div><div class="line">  *	 &#125; </div><div class="line">  */</div><div class="line"></div><div class="line"></div><div class="line"> /**</div><div class="line">   * è€ç‰ˆæœ¬createStoreåªæœ‰å‰ä¸¤ä¸ªå‚æ•°ï¼Œå‘ç°æ–°åŠ äº†ä¸€ä¸ªå‚æ•°</div><div class="line">   * @param &#123;reducer&#125; (currentState,action) =&gt; newState</div><div class="line">   * @param &#123;preloadedState&#125;  initialState</div><div class="line">   * @param &#123;enhancer&#125; ....çœ‹äº†ä¸€ä¸‹APIï¼ŒæŸé«˜é˜¶å‡½æ•°</div><div class="line">   */</div><div class="line"><span class="built_in">export</span> default <span class="keyword">function</span> createStore(reducer, preloadedState, enhancer) &#123;</div><div class="line"></div><div class="line">  // ä»¥ä¸‹å„ç§æ£€æµ‹å‚æ•°ç±»å‹balabala...</div><div class="line">  <span class="keyword">if</span> (typeof preloadedState === <span class="string">'function'</span> &amp;&amp; typeof enhancer === <span class="string">'undefined'</span>) &#123;</div><div class="line">    enhancer = preloadedState</div><div class="line">    preloadedState = undefined</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (typeof enhancer !== <span class="string">'undefined'</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (typeof enhancer !== <span class="string">'function'</span>) &#123;</div><div class="line">      throw new Error(<span class="string">'Expected the enhancer to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">return</span> enhancer(createStore)(reducer, preloadedState)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (typeof reducer !== <span class="string">'function'</span>) &#123;</div><div class="line">    throw new Error(<span class="string">'Expected the reducer to be a function.'</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // ä»¥ä¸‹å®šä¹‰å„ç§åˆå§‹å€¼balabala...</div><div class="line">  <span class="built_in">let</span> currentReducer = reducer</div><div class="line">  <span class="built_in">let</span> currentState = preloadedState</div><div class="line">  <span class="built_in">let</span> currentListeners = []</div><div class="line">  <span class="built_in">let</span> nextListeners = currentListeners</div><div class="line">  <span class="built_in">let</span> isDispatching = <span class="literal">false</span></div><div class="line"></div><div class="line">// ä»å‡½æ•°åå’Œå‚æ•°ä»¥åŠå‡½æ•°é€»è¾‘å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯æ¯”è¾ƒå½“å‰è®¢é˜…æºå’Œä¸‹ä¸€ä¸ªè®¢é˜…æºæ˜¯å¦ç›¸åŒã€‚</div><div class="line">  <span class="keyword">function</span> <span class="function"><span class="title">ensureCanMutateNextListeners</span></span>() &#123;</div><div class="line">    <span class="keyword">if</span> (nextListeners === currentListeners) &#123;</div><div class="line">      // æˆ‘æ“¦ï¼Œsliceè¿˜å¯ä»¥ä¸ä¼ ï¼ˆå®˜æ–¹è¯´æ˜¯å¿…é¡»æœ‰é¦–å‚æ•°ï¼‰ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œä¸ä¼ å°±æ˜¯è¿”å›æœ¬èº«</div><div class="line">      nextListeners = currentListeners.slice()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // Storeçš„å®˜æ–¹API getState:å°±getå½“å‰Stateå‘—</div><div class="line">  <span class="keyword">function</span> <span class="function"><span class="title">getState</span></span>() &#123;</div><div class="line">    <span class="built_in">return</span> currentState</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  // Storeçš„å®˜æ–¹API subscribeï¼šç›‘å¬æ•°æ®å˜åŒ–</div><div class="line">  <span class="keyword">function</span> subscribe(listener) &#123;</div><div class="line">  	 // å‚æ•°æ˜¯ä¸ª dispatch action åçš„å›è°ƒå‡½æ•°</div><div class="line">    <span class="keyword">if</span> (typeof listener !== <span class="string">'function'</span>) &#123;</div><div class="line">      throw new Error(<span class="string">'Expected listener to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">let</span> isSubscribed = <span class="literal">true</span></div><div class="line"></div><div class="line">    ensureCanMutateNextListeners()</div><div class="line">    nextListeners.push(listener)</div><div class="line">	</div><div class="line">	// ç›‘å¬å®Œäº†è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥å–æ¶ˆç›‘å¬</div><div class="line">    <span class="built_in">return</span> <span class="keyword">function</span> <span class="function"><span class="title">unsubscribe</span></span>() &#123;</div><div class="line">      <span class="keyword">if</span> (!isSubscribed) &#123;</div><div class="line">        <span class="built_in">return</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      isSubscribed = <span class="literal">false</span></div><div class="line"></div><div class="line">      ensureCanMutateNextListeners()</div><div class="line">      const index = nextListeners.indexOf(listener)</div><div class="line">      nextListeners.splice(index, 1)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  </div><div class="line">   // Storeçš„å®˜æ–¹APIçš„ã€ç‹è€…ã€‘dispatch:è§¦å‘stateå˜åŒ–çš„ã€å”¯ä¸€ã€‘æ–¹æ³•ï¼Œå‚æ•°actionå¿…é¡»ä¸ºå¯¹è±¡</div><div class="line">  <span class="keyword">function</span> dispatch(action) &#123;</div><div class="line">  	 // actionä¸èƒ½ä¸ºç©º</div><div class="line">    <span class="keyword">if</span> (!isPlainObject(action)) &#123;</div><div class="line">      throw new Error(</div><div class="line">        <span class="string">'Actions must be plain objects. '</span> +</div><div class="line">        <span class="string">'Use custom middleware for async actions.'</span></div><div class="line">      )</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">	 // action.typeä¸èƒ½ä¸ºç©º</div><div class="line">    <span class="keyword">if</span> (typeof action.type === <span class="string">'undefined'</span>) &#123;</div><div class="line">      throw new Error(</div><div class="line">        <span class="string">'Actions may not have an undefined "type" property. '</span> +</div><div class="line">        <span class="string">'Have you misspelled a constant?'</span></div><div class="line">      )</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    <span class="keyword">if</span> (isDispatching) &#123;</div><div class="line">      throw new Error(<span class="string">'Reducers may not dispatch actions.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    try &#123;</div><div class="line">      isDispatching = <span class="literal">true</span></div><div class="line">      </div><div class="line">      // !!!!!ã€åˆ’é‡ç‚¹ã€‘å°† currentState è®¾ç½®ä¸º reducer(currentState, action) è¿”å›çš„å€¼</div><div class="line">      currentState = currentReducer(currentState, action)</div><div class="line">    &#125; finally &#123;</div><div class="line">      isDispatching = <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">	</div><div class="line">	// å¦‚æœæœ‰ç›‘å¬å°±å¾ªç¯è°ƒç”¨ç›‘å¬</div><div class="line">    const listeners = currentListeners = nextListeners</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; listeners.length; i++) &#123;</div><div class="line">      const listener = listeners[i]</div><div class="line">      listener()</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">	// è¿”å›action</div><div class="line">    <span class="built_in">return</span> action</div><div class="line">  &#125;</div><div class="line"></div><div class="line">	//Storeå®˜æ–¹æ–°å¢çš„é«˜çº§APIï¼šæ›¿æ¢storeå½“å‰ç”¨æ¥è®¡ç®—stateçš„ reducer...å®˜æ–¹éƒ½è¯´ä¸æ€ä¹ˆç”¨....</div><div class="line">   <span class="keyword">function</span> replaceReducer(nextReducer) &#123;</div><div class="line">    <span class="keyword">if</span> (typeof nextReducer !== <span class="string">'function'</span>) &#123;</div><div class="line">      throw new Error(<span class="string">'Expected the nextReducer to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    currentReducer = nextReducer</div><div class="line">    dispatch(&#123; <span class="built_in">type</span>: ActionTypes.INIT &#125;)</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">	//Storeå®˜æ–¹æ–°å¢APIï¼šæ–°åˆ°å®˜ç½‘éƒ½æ‰¾ä¸åˆ°å®ƒ=ã€‚=åŸç†æ˜¯ES6çš„ä¿®é¥°ç¬¦ã€‚ä¿®é¥°ç¬¦çš„ä½œç”¨å°±æ˜¯æ‹¿åˆ°è‡ªå·±æƒ³è¦æ‹¿çš„å±æ€§ã€‚è¿™ä¸ªåº”è¯¥ä¹Ÿæ˜¯å·®ä¸å¤šæ„æ€å§ï¼Ÿmobxç”¨çš„å°±æ˜¯observableï¼Œå¯ä»¥æ¯”å¯¹ä¸‹ï¼ï¼ï¼</div><div class="line">   <span class="keyword">function</span> <span class="function"><span class="title">observable</span></span>() &#123;</div><div class="line">    const outerSubscribe = subscribe</div><div class="line">    <span class="built_in">return</span> &#123;</div><div class="line">       subscribe(observer) &#123;</div><div class="line">        <span class="keyword">if</span> (typeof observer !== <span class="string">'object'</span>) &#123;</div><div class="line">          throw new TypeError(<span class="string">'Expected the observer to be an object.'</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">function</span> <span class="function"><span class="title">observeState</span></span>() &#123;</div><div class="line">          <span class="keyword">if</span> (observer.next) &#123;</div><div class="line">            observer.next(getState())</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        observeState()</div><div class="line">        const unsubscribe = outerSubscribe(observeState)</div><div class="line">        <span class="built_in">return</span> &#123; unsubscribe &#125;</div><div class="line">      &#125;,</div><div class="line"></div><div class="line">      [$<span class="variable">$observable</span>]() &#123;</div><div class="line">        <span class="built_in">return</span> this</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">	</div><div class="line">  // åˆå§‹åŒ–çš„æ—¶å€™å°±è‡ªå·±è°ƒç”¨äº†æœ€æ—©å®šä¹‰çš„å¸¸é‡ActionTypes.INIT</div><div class="line">  dispatch(&#123; <span class="built_in">type</span>: ActionTypes.INIT &#125;)</div><div class="line">  </div><div class="line">  // å¯¼å‡ºAPI</div><div class="line">  <span class="built_in">return</span> &#123;</div><div class="line">    dispatch,</div><div class="line">    subscribe,</div><div class="line">    getState,</div><div class="line">    replaceReducer,</div><div class="line">    [$<span class="variable">$observable</span>]: observable</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">export default function compose(...funcs) &#123;</div><div class="line">  if (funcs.length === 0) &#123;</div><div class="line">    return arg =&gt; arg</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (funcs.length === 1) &#123;</div><div class="line">    return funcs[0]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å…³äºreduceæ–¹æ³•</li>
</ul>
<p>æˆ‘åœ¨æµè§ˆå™¨ä½¿ç”¨è¯¥æ–¹æ³•å†™äº†ä¸€ä¸ªæµ‹è¯•å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1,2,3,4,5].reduce(function(a,b,c,d)&#123;</div><div class="line">    console.log(&apos;è¿™æ˜¯aï¼š&apos;+a);</div><div class="line">    console.log(&apos;è¿™æ˜¯bï¼š&apos;+b);</div><div class="line">    console.log(&apos;è¿™æ˜¯cï¼š&apos;+c);</div><div class="line">    console.log(&apos;è¿™æ˜¯dï¼š&apos;+d);</div><div class="line">    return a+b</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">è¿™æ˜¯aï¼š1</div><div class="line">è¿™æ˜¯bï¼š2</div><div class="line">è¿™æ˜¯cï¼š1</div><div class="line">è¿™æ˜¯dï¼š1,2,3,4,5</div><div class="line">è¿™æ˜¯aï¼š3</div><div class="line">è¿™æ˜¯bï¼š3</div><div class="line">è¿™æ˜¯cï¼š2</div><div class="line">è¿™æ˜¯dï¼š1,2,3,4,5</div><div class="line">è¿™æ˜¯aï¼š6</div><div class="line">è¿™æ˜¯bï¼š4</div><div class="line">è¿™æ˜¯cï¼š3</div><div class="line">è¿™æ˜¯dï¼š1,2,3,4,5</div><div class="line">è¿™æ˜¯aï¼š10</div><div class="line">è¿™æ˜¯bï¼š5</div><div class="line">è¿™æ˜¯cï¼š4</div><div class="line">è¿™æ˜¯dï¼š1,2,3,4,5</div><div class="line">15</div></pre></td></tr></table></figure>
<p>ç†è§£æ¯ä¸€ä¸ªå‚æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a:ç¬¬ä¸€æ¬¡æ‰§è¡Œreduceæ—¶å€¼ä¸ºæ•°ç»„ç¬¬ä¸€é¡¹ï¼Œç¬¬äºŒæ¬¡ä¹‹åä¸ºå‰ä¸€æ¬¡å‡½æ•°çš„è¿”å›å€¼ï¼Œä»å³åˆ°å·¦ç»“åˆè¿”å›å€¼a4(a3(a2(a1))</div><div class="line">b:ä¸ºå½“å‰æ‰§è¡Œçš„å€¼</div><div class="line">c:ä¸ºå½“å‰æ‰§è¡Œçš„å€¼çš„ç´¢å¼•</div><div class="line">d:æ‰§è¡Œå‡½æ•°çš„æ•°ç»„</div></pre></td></tr></table></figure>
<p>åœ¨applyMiddlewareä¸­æœ‰ä½¿ç”¨åˆ°è¯¥å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">const middlewareAPI = &#123;</div><div class="line">        getState: store.getState,</div><div class="line">        dispatch: (...args) =&gt; dispatch(...args)</div><div class="line">    &#125;</div><div class="line">chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))</div><div class="line">dispatch = compose(...chain)(store.dispatch)</div></pre></td></tr></table></figure>
<ul>
<li><p>composeå®é™…ä½œç”¨</p>
<p>  å›å¤´çœ‹reduceå‡½æ•°ä¸ä¸­é—´ä»¶çš„å®šä¹‰ï¼Œå¯ä»¥å¾—å‡ºï¼š<br>ä¸­é—´ä»¶çš„dispatchå®é™…éå†æ‰€æœ‰ä¸­é—´ä»¶ï¼Œé€šè¿‡reduceæ‰§è¡Œä»å³åˆ°å·¦çš„ç»“åˆï¼Œä½¿å®ƒä»¬éƒ½è·å¾—åˆå§‹stateå’Œdispatchï¼Œé¿å…é—æ¼ã€‚æœ€åå°†ä¸­é—´ä»¶çš„dispatchç»“åˆåˆ°storeçš„dispatché‡Œé¢ã€‚</p>
</li>
</ul>
<h2 id="utilsé‡Œçš„warning"><a href="#utilsé‡Œçš„warning" class="headerlink" title="utilsé‡Œçš„warning"></a>utilsé‡Œçš„warning</h2><ul>
<li>æŠ›å‡ºå¼‚å¸¸</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">export default function warning(message) &#123;</div><div class="line">  if (typeof console !== &apos;undefined&apos; &amp;&amp; typeof console.error === &apos;function&apos;) &#123;</div><div class="line">    console.error(message)</div><div class="line">  &#125;</div><div class="line">  try &#123;</div><div class="line">    throw new Error(message)</div><div class="line">  &#125; catch (e) &#123; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åœ¨combineReducersé‡Œçš„ä½¿ç”¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">if (process.env.NODE_ENV !== &apos;production&apos;) &#123;</div><div class="line">  if (typeof reducers[key] === &apos;undefined&apos;) &#123;</div><div class="line">    warning(`No reducer provided for key &quot;$&#123;key&#125;&quot;`)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>æ€è€ƒ</p>
<p>  å®é™…è¿ç”¨ä¸­ä¸€èˆ¬æˆ‘ä»¬éƒ½ä½¿ç”¨throw new Errorï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨è¿‡ç»„ä»¶æ¥åŒ…ä¸€å±‚ï¼Œç›´æ¥ä½¿ç”¨ç»„ä»¶æ¥çš„ç®€æ´æ˜äº†ã€‚åœ¨æ—¥åçš„å·¥ç¨‹é¡¹ç›®ä¸­ï¼Œå¯ä»¥å€Ÿé‰´è¿™ä¸ªç»„ä»¶åŠ ä»¥ä½¿ç”¨ã€‚</p>
</li>
</ul>
<p>The End</p>

 
                <!-- Meta -->
                <div class="post-meta">
                    <hr>
                    <br>
                    <div class="post-tags">
                        
                            

<a href="/tags/å¥½æ­¹æˆ‘ä¹Ÿæ˜¯è¯»è¿‡æºç çš„äººäº†/">#å¥½æ­¹æˆ‘ä¹Ÿæ˜¯è¯»è¿‡æºç çš„äººäº†</a>


                        
                    </div>
                    <div class="post-date">
                        2018 å¹´ 02 æœˆ 24 æ—¥
                    </div>
                </div>
            </div>

            <!-- Comments -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Disqus Comments -->


            </div>
        </div>
    </div>
</article>
</section>

    <!-- Scripts -->
    <!-- jQuery -->
<script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script type="text/javascript">
	console.log('Hexo-theme-hollow designed by zchen9 ğŸ™‹ Â© 2015-' + (new Date()).getFullYear());
</script>

    <!-- Google Analytics -->
    

</body>

</html>